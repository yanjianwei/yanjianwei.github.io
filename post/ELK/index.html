<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ELK | 来 自 星 星 的 阿 宝 - 记录点滴 分享心得</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="搭建ELK(Elasticsearch + Logstash + Kibana）ELK简介
ELK(Elasticsearch + Logstash + Kibana）是一套开源的日志分析管理平台解决方案。–ELK

安装Java123sudo add-apt-repository ppa:webupd8team/javasudo apt-get updatesudo apt-get instal">
<meta property="og:type" content="article">
<meta property="og:title" content="ELK">
<meta property="og:url" content="http://yanjianwei.github.io/post/ELK/index.html">
<meta property="og:site_name" content="来 自 星 星 的 阿 宝">
<meta property="og:description" content="搭建ELK(Elasticsearch + Logstash + Kibana）ELK简介
ELK(Elasticsearch + Logstash + Kibana）是一套开源的日志分析管理平台解决方案。–ELK

安装Java123sudo add-apt-repository ppa:webupd8team/javasudo apt-get updatesudo apt-get instal">
<meta property="og:updated_time" content="2016-02-04T06:48:01.086Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ELK">
<meta name="twitter:description" content="搭建ELK(Elasticsearch + Logstash + Kibana）ELK简介
ELK(Elasticsearch + Logstash + Kibana）是一套开源的日志分析管理平台解决方案。–ELK

安装Java123sudo add-apt-repository ppa:webupd8team/javasudo apt-get updatesudo apt-get instal">
  
    <link rel="alternate" href="/atom.xml" title="来 自 星 星 的 阿 宝" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="http://fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">来 自 星 星 的 阿 宝</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon" style="margin-left: 13px;"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
		<a class="nav-icon" href="http://user.qzone.qq.com/446369399" title="QQ空间" target="_blank">&#61910;</a>
		<a class="nav-icon" href="https://github.com/yanjianwei" title="GitHub" target="_blank">&#61595;</a>

        <a id="nav-search-btn" class="nav-icon" style="font-size: 19px; width: 19px; height: 19px; padding: 20px 5px;" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yanjianwei.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ELK" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ELK
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/post/ELK/" class="article-date">
  <time datetime="2016-02-02T01:28:18.000Z" itemprop="datePublished">2016-2-2 周二  09:28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOPS/">DevOPS</a>
  </div>

  </div>

    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
      	
        <h2 id="u642D_u5EFAELK_28Elasticsearch_+_Logstash_+_Kibana_uFF09"><a href="#u642D_u5EFAELK_28Elasticsearch_+_Logstash_+_Kibana_uFF09" class="headerlink" title="搭建ELK(Elasticsearch + Logstash + Kibana）"></a>搭建ELK(Elasticsearch + Logstash + Kibana）</h2><h2 id="ELK_u7B80_u4ECB"><a href="#ELK_u7B80_u4ECB" class="headerlink" title="ELK简介"></a>ELK简介</h2><blockquote>
<p>ELK(Elasticsearch + Logstash + Kibana）是一套开源的日志分析管理平台解决方案。–<a href="https://www.elastic.co/" target="_blank" rel="external">ELK</a></p>
</blockquote>
<h2 id="u5B89_u88C5Java"><a href="#u5B89_u88C5Java" class="headerlink" title="安装Java"></a>安装Java</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:webupd8team/java</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install oracle-java8-installer</span><br></pre></td></tr></table></figure>
<h3 id="u68C0_u67E5java_u7248_u672C"><a href="#u68C0_u67E5java_u7248_u672C" class="headerlink" title="检查java版本"></a>检查java版本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubunt1404:~<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_72"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build <span class="number">1.8</span><span class="number">.0</span>_72-b15)</span><br><span class="line">Java HotSpot(TM) <span class="number">64</span>-Bit Server VM (build <span class="number">25.72</span>-b15, mixed mode)</span><br></pre></td></tr></table></figure>
<h3 id="u8BBE_u7F6Ejava_u73AF_u5883"><a href="#u8BBE_u7F6Ejava_u73AF_u5883" class="headerlink" title="设置java环境"></a>设置java环境</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install oracle-java8-set-default</span><br></pre></td></tr></table></figure>
<h2 id="u5B89_u88C5elasticsearch"><a href="#u5B89_u88C5elasticsearch" class="headerlink" title="安装elasticsearch"></a>安装elasticsearch</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/zip/elasticsearch/<span class="number">2.1</span><span class="number">.1</span>/elasticsearch-<span class="number">2.1</span><span class="number">.1</span>.zip --no-check-certificate</span><br><span class="line">unzip elasticsearch-<span class="number">2.1</span><span class="number">.1</span>.zip</span><br><span class="line">cd elasticsearch-<span class="number">2.1</span><span class="number">.1</span>/bin</span><br></pre></td></tr></table></figure>
<h2 id="u8FD0_u884Celasticsearch"><a href="#u8FD0_u884Celasticsearch" class="headerlink" title="运行elasticsearch"></a>运行elasticsearch</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubunt1404:~/elasticsearch-2.1.1/bin#./elasticsearch</span><br><span class="line">   Exception in thread "main" java.lang.RuntimeException: don't run elasticsearch as root.</span><br><span class="line">at org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:93)</span><br><span class="line">at org.elasticsearch.bootstrap.Bootstrap.set(Bootstrap.java:144)</span><br><span class="line">at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:285)</span><br><span class="line">at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)</span><br><span class="line">Refer to the log for complete error details.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>elasticsearch出于安全考虑，不容许以root身份运行。因此，创建elsearch用户组及elsearch用户</p>
</blockquote>
<h2 id="u521B_u5EFAelk_u7528_u6237_u53CA_u7528_u6237_u7EC4"><a href="#u521B_u5EFAelk_u7528_u6237_u53CA_u7528_u6237_u7EC4" class="headerlink" title="创建elk用户及用户组"></a>创建elk用户及用户组</h2><pre><code class="bash">adduser elk
chown -R elk:elk elasticsearch-2.1.1
mv elasticsearch-2.1.1 /opt
</code></pre>
<h2 id="u8FD0_u884Celasticsearch-1"><a href="#u8FD0_u884Celasticsearch-1" class="headerlink" title="运行elasticsearch"></a>运行elasticsearch</h2><pre><code class="python">elk@ubunt1404:/opt/elasticsearch-2.1.1/bin$ ./elasticsearch
[2015-10-28 12:17:48,107][INFO ][node                     ] [Toxin] version[2.1.1], pid[5056], build[40e2c53/2015-12-15T13:05:55Z]
[2015-10-28 12:17:48,108][INFO ][node                     ] [Toxin] initializing ...
[2015-10-28 12:17:48,246][INFO ][plugins                  ] [Toxin] loaded [], sites []
[2015-10-28 12:17:48,295][INFO ][env                      ] [Toxin] using [1] data paths, mounts [[/ (/dev/mapper/ubunt1404--vg-root)]], net usable_space [42.3gb], net total_space [46.8gb], spins? [possibly], types [ext4]
[2015-10-28 12:17:51,107][INFO ][node                     ] [Toxin] initialized
[2015-10-28 12:17:51,107][INFO ][node                     ] [Toxin] starting ...
[2015-10-28 12:17:51,244][INFO ][transport                ] [Toxin] publish_address {127.0.0.1:9300}, bound_addresses {127.0.0.1:9300}, {[::1]:9300}
[2015-10-28 12:17:51,254][INFO ][discovery                ] [Toxin] elasticsearch/olCauzN6QMWhU8yoxaBexw
[2015-10-28 12:17:54,314][INFO ][cluster.service          ] [Toxin] new_master {Toxin}{olCauzN6QMWhU8yoxaBexw}{127.0.0.1}{127.0.0.1:9300}, reason: zen-disco-join(elected_as_master, [0] joins received)
[2015-10-28 12:17:54,339][INFO ][http                     ] [Toxin] publish_address {127.0.0.1:9200}, bound_addresses {127.0.0.1:9200}, {[::1]:9200}
[2015-10-28 12:17:54,339][INFO ][node                     ] [Toxin] started
[2015-10-28 12:17:54,366][INFO ][gateway                  ] [Toxin] recovered [0] indices into cluster_state
</code></pre>
<h2 id="u4FEE_u6539_u914D_u7F6E"><a href="#u4FEE_u6539_u914D_u7F6E" class="headerlink" title="修改配置"></a>修改配置</h2><pre><code class="python">vi config/elasticsearch.yml
network.host: <span class="number">172.171</span><span class="number">.4</span><span class="number">.59</span>
http.port: <span class="number">9200</span>
</code></pre>
<h2 id="u540E_u53F0_u8FD0_u884Celasticsearch"><a href="#u540E_u53F0_u8FD0_u884Celasticsearch" class="headerlink" title="后台运行elasticsearch"></a>后台运行elasticsearch</h2><pre><code class="pyhton">./elasticsearch -d
</code></pre>
<h2 id="u8BBF_u95EE_u6D4B_u8BD5"><a href="#u8BBF_u95EE_u6D4B_u8BD5" class="headerlink" title="访问测试"></a>访问测试</h2><pre><code class="python">elk@ubunt1404:~$curl -XGET http://172.171.4.59:9200/?pretty
{
"name" : "Ashcan",
"cluster_name" : "elasticsearch",
"version" : {
"number" : "2.1.1",
"build_hash" : "40e2c53a6b6c2972b3d13846e450e66f4375bd71",
"build_timestamp" : "2015-12-15T13:05:55Z",
"build_snapshot" : false,
"lucene_version" : "5.3.1"
},
"tagline" : "You Know, for Search"
}
</code></pre>
<h2 id="u5B89_u88C5Kibana"><a href="#u5B89_u88C5Kibana" class="headerlink" title="安装Kibana"></a>安装Kibana</h2><pre><code class="python">wget https://download.elastic.co/kibana/kibana/kibana<span class="number">-4.3</span><span class="number">.1</span>-linux-x64.tar.gz --no-check-certificate
tar zxf kibana<span class="number">-4.3</span><span class="number">.1</span>-linux-x64.tar.gz
elk@ubunt1404:~/kibana<span class="number">-4.3</span><span class="number">.1</span>-linux-x64$ vi config/kibana.yml
server.port: <span class="number">5601</span>
server.host: <span class="string">"172.171.4.59"</span>
elasticsearch.url: <span class="string">"http://172.171.4.59:9200"</span>
</code></pre>
<h2 id="u542F_u52A8_u670D_u52A1"><a href="#u542F_u52A8_u670D_u52A1" class="headerlink" title="启动服务"></a>启动服务</h2><pre><code class="python">elk@ubunt1404:~/kibana<span class="number">-4.3</span><span class="number">.1</span>-linux-x64/bin$ ./kibana
</code></pre>

      
    </div>
    <footer class="article-footer">
	  
	    <div class="bdsharebuttonbox"><a href="http://yanjianwei.github.io/post/ELK/">分享到：</a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网">人人网</a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook">Facebook</a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter">Twitter</a><a href="#" class="bds_more" data-cmd="more">其他平台</a></div>
      
	  
      
        <a href="http://yanjianwei.github.io/post/ELK/#ds-thread" class="ds-thread-count article-comment-link" data-thread-key="post/ELK/">评论</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ELK/">ELK</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/devops/">devops</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/post/hello-world3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World3</div>
    </a>
  
</nav>

  
</article>

<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="post-ELK" data-title="ELK" data-url="http://yanjianwei.github.io/post/ELK/" ></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yanjianwei"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->



</section>
        
          
<aside id="sidebar">

  
    <div class="widget-wrap">
  <h3 class="widget-title">关于我</h3>
  <ul class="widget about-me">
    <li><img class="author" title="About me" src="/css/images/avatar.png" /></li>
    
    <li><a href="http://yanjianwei.github.io">阿宝</a></li>
    
    <li>Jianwei Yan</li>
    
    <li>微信号：yjw2288</li>
    
  </ul>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/post/ELK/">ELK</a>
          </li>
        
          <li>
            <a href="/post/hello-world3/">Hello World3</a>
          </li>
        
          <li>
            <a href="/post/hello-world2/">Hello World2</a>
          </li>
        
          <li>
            <a href="/post/hello-world/">Hello World1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOPS/">DevOPS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Openstack/">Openstack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 14px; color: #7dc3de">Docker</a> <a href="/tags/ELK/" style="font-size: 14px; color: #7dc3de">ELK</a> <a href="/tags/Java/" style="font-size: 17px; color: #7f62af">Java</a> <a href="/tags/devops/" style="font-size: 14px; color: #7dc3de">devops</a> <a href="/tags/linux/" style="font-size: 20px; color: #800080">linux</a> <a href="/tags/openstack/" style="font-size: 17px; color: #7f62af">openstack</a> <a href="/tags/python/" style="font-size: 17px; color: #7f62af">python</a> <a href="/tags/shell/" style="font-size: 14px; color: #7dc3de">shell</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">索引</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li></ul>
    </div>
  </div>


  
    
<div class="widget-wrap">
  <h3 class="widget-title">友情链接</h3>
  <ul class="widget">
    
    <li><a href="http://www.openstack.cn/" target="_BLANK">●&emsp;Openstack中国社区</a></li>
    
    <li><a href="http://www.sdnlab.com/" target="_BLANK">●&emsp;SDN实验平台</a></li>
    
    <li><a href="http://www.dockone.io/" target="_BLANK">●&emsp;Docker容器社区</a></li>
    
  </ul>
</div>


  

</aside>
        
      </div>
      <footer id="footer">
  
  <img src="/css/images/umaru.png" style="position:fixed; right:0; bottom:0; width:70px">
  <div class="outer">
    <div id="footer-info" class="inner" style="text-align:center;">
	  <table width="100%" border="0">
        <tr>
          <td style="text-align:left; border: 0;">
            Copyright &copy; 2015-2016 Jianwei Yan &emsp;
		</td>
		  <td style="text-align:right; border: 0;">
		    <div style="font-family: FontAwesome;font-size: 20px;">
			<a href="http://user.qzone.qq.com/446369399" title="QQ空间" target="_blank">&#61910;</a>&nbsp;
			<a href="https://github.com/yanjianwei" title="GitHub" target="_blank">&#61595;</a>&nbsp;
			</div>
			<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1255146829'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1255146829' type='text/javascript'%3E%3C/script%3E"));</script>
			&nbsp;
		  </td>
        </tr>
      </table>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"hkeyc17"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

<script>
var option = {
  engineKey: '695d0ac61847d1e43931'
};
(function(w,d,t,u,n,s,e){
  s = d.createElement(t);
  s.src = u;
  s.async = 1;
  w[n] = function(r){
    w[n].opts = r;
  };
  e = d.getElementsByTagName(t)[0];
  e.parentNode.insertBefore(s, e);
})(window,document,'script','//tinysou-cdn.b0.upaiyun.com/ts.js','_ts');
_ts(option);
</script>
<script src="http://lib.sinaapp.com/js/jquery/2.0.3/jquery-2.0.3.min.js"></script>
<script type="text/javascript">
//<![CDATA[
if (typeof jQuery == 'undefined') {
  document.write(unescape("%3Cscript src='/js/jquery-2.0.3.min.js' type='text/javascript'%3E%3C/script%3E"));
}
// ]]>
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

<div class="bottom-btn">

	<a class="icon-gotop" href="javascript:void(0)" title="返回顶部"></a>
	<script src="/js/gotop.js" type="text/javascript"></script>
	<!--
	<script src="/js/gotop.js"></script>
	-->

</div>


<script src="/js/script.js" type="text/javascript"></script>
<!-- Baidu Share Start --->
<script>window._bd_share_config={"common":{"bdSnsKey":{"tsina":"1714312189"},"bdWbuid":3904642734,"bdText":"","bdMini":"2","bdMiniList":["douban","kaixin001","tieba","tsohu","sqq","youdao","qingbiji","mail","linkedin","mshare","copy","print"],"bdStyle":"1","bdSize":"24"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!-- Baidu Share End --->
  </div>
</body>
</html>